# 多文件编辑

在vim中使用缓冲区、窗口和标签页来进行多文件编辑。所以在开始之前就必须先了解他们具体是什么:

- 缓冲区:即buffer，文件打开后被放入内存，而这部分存储了正在编辑的文件的内存区域就是缓冲区，如果没有把缓冲区中的文件存盘，那么原始文件就不会被更改，例如:w命令就是将缓冲区内的文件固化到硬盘上的命令。
- 窗口:窗口用来查看缓冲区里的内容，你可以用多个窗口查看同一个缓冲区，也可以用多个窗口观察不同的缓冲区
- 标签页:标签页是窗口的集合

## 多窗口

### 打开窗口

启动vim的时候如果指定了多个文件，会同时将文件写入buffer中，而只启动一个窗口打开第一个文件，可以指定-o命令来为每个文件提供一个窗口: 

- vim -o file1 file2 file3 同时三个水平窗口显示这些文件 如果想要垂直分割使用O

vim中窗口分为水平分割和垂直分割，都有相应的命令来打开他们，默认情况下分割的窗口为当前窗口的高度/宽度的一半: 

- :sp Ctrl+W s 这两个命令都可以创建一个水平分割窗口，其中一个是命令行命令一个是normal快捷键
- :vs Ctrl+W v 这两个命令可以创建一个垂直分割窗口
- :new Ctrl+w n 默认情况下，sp vs命令都会打开当前窗口中显示的缓冲区，如果你想要打开一个空文件可以使用这个命令，改名了会新建一个缓冲区其中没有任何内容，其跟:sp后再执行:enew差不多
- :sp/vs/new file 以上三个命令行下的窗口分割命令都可以跟一个文件来在创建窗口的时候打开该文件，其实跟创建完以后使用:e命令一样

### 关闭窗口

需要注意的是，关闭窗口并不会关闭文件缓冲区，除非是关闭最后一个窗口。  

- :q Ctrl+w q 退出当前窗口，如果退出的是最后一个窗口，会提出vim，如果此时缓冲区文件并没有被保存，则不能退出，除非使用:q!
- :close Ctrl+w c 这是个相对安全的命令，当屏幕上只剩下一个窗口是无法被执行
- :only Ctrl+W o 使当前窗口成为屏幕上唯一的窗口。

### 移动光标到另一个窗口

你可以发现，关于窗口的normal命令都是以Ctrl+w作为前缀的.

- Ctrl+w j 光标下移一个窗口
- Ctrl+w h 光标左移一个窗口
- Ctrl+w k 光标下移一个窗口
- Ctrl+w l 光标右移一个窗口
- Ctrl+w w 依次移动光标

### 移动窗口

- Ctrl+w J 移动窗口到最底部
- Ctrl+w H 移动窗口到最左边
- Ctrl+w L 移动窗口到最右边
- Ctrl+w K 移动窗口到最顶部
- Ctrl+w T 移动窗口到一个新的标签页上，如果当前标签页只有一个窗口不能被执行

### 改变窗口大小

- Ctrl+w = 使窗口等宽等高
- Ctrl+w - 使当前窗口高度减少默认为1
- ctrl+w + 使当前窗口高度增加
- Ctrl+w \< 使当前窗口宽度减少
- Ctrl+w \> 使当前窗口宽度增加

### 滚动屏幕

这里添加一个补充信息就是滚动屏幕

- Ctrl+e 使窗口在缓冲区中向下滚动一行
- Ctrl+y 使窗口在缓冲区中向上滚动一行
- Ctrl+d 使窗口在缓冲区中向下滚动半屏
- Ctrl+u 使窗口在缓冲区中向上滚动半屏
- Ctrl+f 是窗口在缓冲区中向下滚动一页
- Ctrl+b 使窗口在缓冲区中向上滚动一页

## buffer相关命令

每个缓冲区都有一个唯一的号码与之对应，这个编号是不会改变的，所以可以使用:buffer N来选择特定的缓冲区:

> 1 %a + "vim多文件编辑.md" line 62  
> 1 缓冲区的编号 如果后面是u表示列表外缓冲区，可以使用:ls!来显示  
> % 当前缓冲区，还可以是 # 表示使用ctrl+^可以切换到的轮换缓冲区
> a 激活的缓冲区，以载入内存且可见 h 表示以载入内存但没有窗口显示他们
> + 已经更改的缓冲区 - 不可更改的缓冲区 = 只读缓冲区 x 有读错误的缓冲区


- :buffers :ls 显示缓冲区列表，有些缓冲区是隐藏的可以使用 :ls!来显示出来 例如帮助文件NERDTree的目录树等
- :buffer N 切换到地N个缓冲区
- :bnext 向后切换缓冲区
- :bprevious 向前切换缓冲区
- :sbuffer N  分割屏幕，并切换到第N个缓冲区,注意上面的命令都是在当前窗口切换，这个会新建一个窗口
- :sbnext :sbprevious 同理
- :badd file 将文件添加到缓冲区列表，但是并不载入内存，不要使用这个命令来打开文件，会乱码
- :bdelete N 卸载缓冲区

## 标签

每个标签可以人容纳多个窗口，可以将不同的工作放置到不同的标签页中。

### 新建标签页

- vim -p file1 file2 为每个文件打开一个新标签页
- :tabnew file 在当前标签页后打开文件新建一个标签页，如果不指定file则打开空窗口

### 关闭标签页

- :tabclose 关闭当前标签页，其后可以跟数字表示关闭第几个标签页
- :tabonly 关闭所有其他标签页

### 切换标签页

- :tabnext gt 切换到下一个标签页，可以跟数字表示切换到第几个

### 其他标签页命令

- :tabs 列出所有标签页和他们包含的窗口
